<button mat-button (click)="authService.logout()">Logout</button>
<button mat-button (click)="toggleView()">{{showSubs ? "Find Mangas" : "View Subscriptions"}}</button>

<div class="spinner-container" *ngIf="(mangaDataSource.loading$ | async) || (mangaItemDataSource.loading$ | async)">
  <mat-progress-bar mode="indeterminate"></mat-progress-bar>
</div>

<!-- ------------------------ Subscription Page ------------------------ -->
<div [hidden]="!showSubs">
  <div class="subscription-container">
    <!--<div class="spinner-container" *ngIf="mangaItemDataSource.loading$ | async">
      <mat-spinner></mat-spinner>
    </div>-->

    <table mat-table class="manga-table" [dataSource]="mangaItemDataSource">
      <ng-container matColumnDef="mangas">
        <th mat-header-cell *matHeaderCellDef>Mangas</th>
        <td mat-cell *matCellDef="let manga">
          <div class="manga-item">
            <div>
              <img [src]="manga.img_src" class="manga-img" />
            </div>
            <div class="manga-details-container">
              <a class="manga-title" [href]="manga.link" target="_blank" rel="noreferrer">{{manga.name}}</a>
              <div *ngIf="manga.release_date !== ''" class="chapter-details">
                <a class="chapter-link"
                   [href]="manga.chapter_link"
                   target="_blank"
                   rel="noreferrer">
                  Latest Chapter: {{manga.latest_chapter}}
                </a>
                <span class="chapter-date">{{manga.release_date}}</span>
              </div>
              <div *ngIf="manga.release_date === ''">
                <p>Retrieving Latest Chapter data!</p>
              </div>

              <button mat-button (click)="removeSubscription(manga.id)" color="accent">Get this out of Here!</button>
            </div>
          </div>
        </td>
      </ng-container>

      <tr mat-header-cell *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
    <mat-paginator [pageSizeOptions]="[5, 10, 20, 50, 100]" [length]="mangaItemDataSource?.length$ | async" [pageSize]="5"></mat-paginator>
  </div>
</div>

<!-- ------------------------ Manga Search Page ------------------------ -->
<div [hidden]="showSubs">
  <div class="search-results-container">
    <div>
      <mat-form-field appearance="outline">
        <mat-label>Manga Sites</mat-label>
        <mat-select [(ngModel)]="selectedSite">
          <mat-option *ngFor="let manga of mangaSites" [value]="manga">
            {{manga}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field appearance="outline">
        <mat-label>Search for Manga</mat-label>
        <input matInput #mangaKeywords (keyup.enter)="searchMangaSite(mangaKeywords.value)">
      </mat-form-field>
    </div>

    <!--<div class="spinner-container" *ngIf="mangaDataSource.loading$ | async">
      <mat-spinner></mat-spinner>
    </div>-->

    <table mat-table class="manga-table" [dataSource]="mangaDataSource">
      <ng-container matColumnDef="mangas">
        <th mat-header-cell *matHeaderCellDef>Mangas</th>
        <td mat-cell *matCellDef="let manga">
          <div class="manga-item">
            <div>
              <img [src]="manga.img_src" class="manga-img" />
            </div>
            <div class="manga-details-container">
              <a class="manga-title" [href]="manga.link" target="_blank" rel="noreferrer">{{manga.name}}</a>
              <button mat-button (click)="subscribe(manga)">Add</button>
            </div>
          </div>
        </td>
      </ng-container>

      <tr mat-header-cell *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

    <mat-paginator [pageSizeOptions]="[5, 10, 20, 50, 100]" [length]="mangaDataSource?.length$ | async" [pageSize]="5"></mat-paginator>
  </div>
</div>
